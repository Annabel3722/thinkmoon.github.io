__NUXT_JSONP__("/post/306", (function(a,b,c){return {data:[{article:{cid:306,title:"uni-app使用fly封装网络请求接口",slug:"306",created:1557992220,modified:1574409332,text:"\u003C!--markdown--\u003E## 介绍\r\n\r\n本文采用`uni-app`框架开发，使用[flyio](https:\u002F\u002Fgithub.com\u002Fwendux\u002Ffly)库封装请求。\r\n\r\n### 安装方式\r\n\r\n```shell\r\nnpm install --save flyio\r\n```\r\n\r\n### 引入方式\r\n\r\n新建`api.js`文件，编写以下内容\r\n\r\n```javascript\r\nvar Fly = require(\"flyio\u002Fdist\u002Fnpm\u002Fwx\")\r\nvar fly = new Fly;\r\n```\r\n\r\n### 配置方式\r\n\r\n```javascript\r\n\u002F\u002F 配置请求根域名\r\nfly.config.baseURL = \"http:\u002F\u002Fwhisper.wezoz.com\"\r\n\u002F\u002F 配置响应拦截器\r\nfly.interceptors.response.use(\r\n\t(response) =\u003E {\r\n\t\t\t\u002F\u002F 如果请求报错\r\n\t\t\tif (response.data.code != 10000) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle:'温馨提示',\r\n\t\t\t\t\tcontent:response.data.data\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\t\u002F\u002F只将请求结果的data字段返回\r\n\t\t\t\treturn response.data.data\r\n\t\t\t}\r\n\t\t},\r\n\t\t(err) =\u003E {\r\n\t\t\t\u002F\u002F发生网络错误后会走到这里\r\n\t\t\treturn Promise.resolve(\"网络请求：ERROR！\")\r\n\t\t}\r\n)\r\n\u002F\u002F 配置请求拦截器\r\nfly.interceptors.request.use((request) =\u003E {\r\n\trequest.headers[\"token\"] = uni.getStorageSync('token');\r\n\treturn request;\r\n})\r\n```\r\n\r\n## 同步封装微信登录\r\n\r\n```javascript\r\nasync function wxLogin() {\r\n\treturn await new Promise((resolve, reject) =\u003E {\r\n\t\twx.login({\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tif (res.code) {\r\n\t\t\t\t\tresolve(res.code)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n```\r\n\r\n写一个接口如login\r\n\r\n```javascript\r\n\u002F\u002F 登录\r\nexport const login = async (params) =\u003E {\r\n\tconsole.log('开始登录...')\r\n\tlet code = await wxLogin();\r\n\tlet res = await fly.get('\u002Fuser\u002Flogin', {code: code})\r\n\tuni.setStorageSync('token', res.token)\r\n\tuni.setStorageSync('openid', res.openid)\r\n}\r\n```\r\n\r\n## 封装普通请求\r\n\r\n```javascript\r\nexport const updateUserInfo = (params) =\u003E {\r\n\treturn fly.get('\u002Fuser\u002Fupdate', params)\r\n}\r\n```\r\n\r\n## 引入方式\r\n\r\n在`App.vue` 或者`main.js`添加以下代码\r\n\r\n```javascript\r\nimport * as API from '.\u002Fstatic\u002Futils\u002Fapi'\r\nVue.prototype.$api = API\r\n```\r\n\r\n## 调用方式\r\n\r\n\u003E test.vue\r\n\r\n```javascript\r\nthis.$api.login()\r\n```\r\n\r\n  [1]: https:\u002F\u002Fwww.thinkmoon.cn\u002Fusr\u002Fuploads\u002F2019\u002F05\u002F3661142475.png",order:b,authorId:1,type:"post",status:"publish",commentsNum:c,allowComment:a,allowPing:a,allowFeed:a,parent:b,views:4546,likes:c}}],fetch:{},mutations:void 0}}("1",0,4)));
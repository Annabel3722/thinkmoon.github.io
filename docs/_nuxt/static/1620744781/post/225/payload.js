__NUXT_JSONP__("/post/225", (function(a,b){return {data:[{article:{cid:225,title:"让微信小程序页面默认支持分享及返回操作",slug:"225",created:1551859080,modified:1574657602,text:"\u003C!--markdown--\u003E## 为啥需要这个？\r\n\u003E 有时候我们写微信小程序，写好了。在手机上运行感觉效果还不错，正想分享给别人。突然发现没有分享选项，纳尼？原来是忘记写`onShareAppMessage()`了。有得加上，再编译。不得不说，麻烦的一匹。\r\n\r\n## 应运而生\r\n\u003E 然后我就想，要是可以让默认支持分享就好了。\r\n## wepy实现方法\r\n## 大致思路\r\n```\r\nimport wepy from 'wepy';\r\nexport default class Page extends wepy.page {\r\n}\r\n```\r\n\u003E 分析代码，发现所有的`page`都继承于`wepy.page`, 而`wepy.page`又继承于`wepy.component`. 这感情好。也就意味着我只需要构建一个超类继承`wepy.page`就可以了\r\n\r\n## 实践\r\n\u003E 新建page.js文件，内容如下\r\n```javascript\r\nimport wepy from 'wepy';\r\nexport default class Page extends wepy.page {\r\n    onShareAppMessage() {\r\n        \r\n    }\r\n}\r\n```\r\n\u003E 然后再调整一下页面继承\r\n```\r\nimport Page from '..\u002Fpage';\r\nexport default class Index extends Page {\r\n}\r\n```\r\n\r\n\u003E 编译运行，果然如此！\r\n\r\n## 如果要自定义分享内容怎么办？\r\n\u003E 在子page里面重构`onShareAppMessage`就可以啦。\r\n\r\n\r\ntips: 现使用uni-app后发现已经默认支持分享了\r\n\r\n## 后续： uni-app说这是个BUG，已经修复了。。\r\n\r\n## 后备方案——使用mixin全局混入\r\n1. 在main.js中添加以下内容。\r\n```\r\nimport qs from 'query-string'\r\nVue.mixin({\r\n\tonShareAppMessage() {\r\n\t\tconsole.log('分享路径', '\u002Fpages\u002Findex?route=' + this.$mp.page.route + '&' + qs.stringify(this.$mp.query))\r\n\t\treturn {\r\n\t\t\tpath: '\u002Fpages\u002Findex?route=' + this.$mp.page.route + '&' + qs.stringify(this.$mp.query)\r\n\t\t};\r\n\t}\r\n})\r\n```\r\n以上代码实现了所有页面都支持转发，并将转发路径设为主页。\r\n2. 在主页的onLoad函数中加入以下内容\r\n```\r\nif (options.route) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '\u002F' + options.route + '?' + qs.stringify(options)\r\n\t\t\t\t})\r\n\t\t\t}\r\n```\r\n这样就实现了，进入后的页面跳转。\r\n3. 为什么要这样做？\r\n因为大家都知道，当我们直接分享小程序页面给别人的时候。别人点击进入非tab页面，是没有返回操作的。增加了上面的功能后，所有页面的分享，都会先进入主页，再跳转至分享的页面。用户就可以无缝对接啦！\r\n\r\n\u003E 更新，现小程序已支持页面返回",order:a,authorId:1,type:"post",status:"publish",commentsNum:a,allowComment:b,allowPing:b,allowFeed:b,parent:a,views:1187,likes:2}}],fetch:{},mutations:void 0}}(0,"1")));
<!doctype html>
<html data-n-head-ssr lang="zh-CN" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22zh-CN%22%7D%7D">
<head>
  <title>Vue环境变量和模式</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta data-n-head="ssr" data-hid="description" name="description" content="指尖魔法屋"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="/highlight/atom-one-dark.min.css"><link data-n-head="ssr" rel="stylesheet" href="/style.css"><script data-n-head="ssr" src="/highlight/highlight.min.js"></script><link rel="preload" href="/_nuxt/b0f8911.js" as="script"><link rel="preload" href="/_nuxt/fc6b942.js" as="script"><link rel="preload" href="/_nuxt/css/a5b6cb0.css" as="style"><link rel="preload" href="/_nuxt/a1b9b3d.js" as="script"><link rel="preload" href="/_nuxt/02b3e78.js" as="script"><link rel="stylesheet" href="/_nuxt/css/a5b6cb0.css"><link rel="preload" href="/_nuxt/static/1619942794/post/894/state.js" as="script"><link rel="preload" href="/_nuxt/static/1619942794/post/894/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1619942794/manifest.js" as="script">
</head>
<body>
<div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="container"><div class="article-content"><h1 class="article-title">Vue环境变量和模式</h1> <div><h1 id="vue环境变量和模式">Vue环境变量和模式</h1>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/image-20200710134543169.png" alt="Vue环境变量和模式"></p>
<p>我最开始使用vue的判断环境的方法是</p>
<pre><code class="language-javascript">let BASE_URL = process.env.NODE_ENV == "development" ? "http:/localhost" : "xxx"
</code></pre>
<p>在这种情况下，需要先判断它的编译环境，进而根据环境适用对应的值。如果只有一个地方的变量跟环境有关，情况还好。但是若有多个，则需要复制多个判断或者封装成一个方法。但也只能使用于两个环境，如果存在多个环境，诸如开发，测试，预发布，正式等环境，这个方法就捉襟见肘了。所以，我们需要设置Vue环境变量和模式，好像webpack也可以实现？（好吧，这不是重点）</p>
<h2 id="实现方式">实现方式</h2>
<p>vue允许你在项目根目录下添加.env.[mode]的文件来指定环境变量。</p>
<pre><code class="language-javascript">.env                # 在所有的环境中被载入
.env.local          # 在所有的环境中被载入，但会被 git 忽略
.env.[mode]         # 只在指定的模式中被载入
.env.[mode].local   # 只在指定的模式中被载入，但会被 git 忽略
</code></pre>
<p>比如我，我添加了<code>.env.local</code>,<code>.env.development</code>,<code>.env.test</code>,<code>.env.production</code>等文件，.env.local文件内容如下。</p>
<blockquote>
<p>.env.local</p>
</blockquote>
<pre><code class="language-javascript">VUE_APP_BUILD_MODE = 'development'
VUE_APP_BASE_URL = 'http://172.16.6.132:8002/threemiju/'
</code></pre>
<p>对应<code>package.json</code>的script如下:</p>
<pre><code class="language-json">"scripts": {
    "serve": "vue-cli-service serve --mode",
    "serve:test": "vue-cli-service serve --mode test",
    "build:test": "vue-cli-service build --mode test",
    "build:production": "vue-cli-service build --mode production",
    "deploy:test": "git push && git push gitlab dev && vue-cli-service build --mode test"
  },
</code></pre>
<blockquote>
<p>请注意，此处有一个坑。当你使用<code>yarn run build:test</code>的时候，你会发现，假如你使用了异步组件，却会神奇的发现，它并没有把把代码切割，只编译成了一个app.js文件，这是由于你使用了<code>--mode test</code>, 导致它认为你并不是prodution环境。所以，你需要对<code>.env.test</code>做以下修改</p>
</blockquote>
<ul>
<li>.env.test</li>
</ul>
<pre><code class="language-javascript">NODE_ENV = 'production'
VUE_APP_BUILD_MODE = 'test'
VUE_APP_BASE_URL = 'https://m.gileey.cn/threemiju/'
</code></pre>
<p>主动设置NODE_ENV即可。</p>
<h2 id="环境变量的使用场景">环境变量的使用场景</h2>
<ol>
<li>BASE_URL</li>
</ol>
<pre><code class="language-javascript">export const baseURL = process.env.VUE_APP_BASE_URL;
</code></pre>
<ol start="2">
<li>BUILD_MODE</li>
</ol>
<p>在显示版本号时同时显示编译环境</p>
<pre><code class="language-jsx">&lt;span :title="mode">{{ version }}&lt;/span>
</code></pre>
<pre><code class="language-javascript">data(){
return {mode: process.env.VUE_APP_BUILD_MODE}
}
</code></pre>
<h2 id="本地变量local的一些应用场景">本地变量(*.local)的一些应用场景</h2>
<ol>
<li>BASE_URL: 在不同的开发机器下，请求不同内网地址</li>
<li>APP_SECRET: 该字段不宜出现在共有仓库</li>
</ol>
</div></div></div></div></div></div><script defer src="/_nuxt/static/1619942794/post/894/state.js"></script><script src="/_nuxt/b0f8911.js" defer></script><script src="/_nuxt/fc6b942.js" defer></script><script src="/_nuxt/a1b9b3d.js" defer></script><script src="/_nuxt/02b3e78.js" defer></script>
</body>
<script defer>hljs.highlightAll()</script>
</html>

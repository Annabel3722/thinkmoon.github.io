<!doctype html>
<html data-n-head-ssr lang="zh-CN" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22zh-CN%22%7D%7D">
<head>
  <title>uni-app使用fly封装网络请求接口</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta data-n-head="ssr" data-hid="description" name="description" content="指尖魔法屋"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="/highlight/atom-one-dark.min.css"><link data-n-head="ssr" rel="stylesheet" href="/style.css"><script data-n-head="ssr" src="/highlight/highlight.min.js"></script><link rel="preload" href="/_nuxt/b0f8911.js" as="script"><link rel="preload" href="/_nuxt/fc6b942.js" as="script"><link rel="preload" href="/_nuxt/css/a5b6cb0.css" as="style"><link rel="preload" href="/_nuxt/a1b9b3d.js" as="script"><link rel="preload" href="/_nuxt/02b3e78.js" as="script"><link rel="stylesheet" href="/_nuxt/css/a5b6cb0.css"><link rel="preload" href="/_nuxt/static/1619942794/post/306/state.js" as="script"><link rel="preload" href="/_nuxt/static/1619942794/post/306/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1619942794/manifest.js" as="script">
</head>
<body>
<div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="container"><div class="article-content"><h1 class="article-title">uni-app使用fly封装网络请求接口</h1> <div><h2 id="介绍">介绍</h2>
<p>本文采用<code>uni-app</code>框架开发，使用<a href="https://github.com/wendux/fly">flyio</a>库封装请求。</p>
<h3 id="安装方式">安装方式</h3>
<pre><code class="language-shell">npm install --save flyio
</code></pre>
<h3 id="引入方式">引入方式</h3>
<p>新建<code>api.js</code>文件，编写以下内容</p>
<pre><code class="language-javascript">var Fly = require("flyio/dist/npm/wx")
var fly = new Fly;
</code></pre>
<h3 id="配置方式">配置方式</h3>
<pre><code class="language-javascript">// 配置请求根域名
fly.config.baseURL = "http://whisper.wezoz.com"
// 配置响应拦截器
fly.interceptors.response.use(
    (response) => {
            // 如果请求报错
            if (response.data.code != 10000) {
                uni.showModal({
                    title:'温馨提示',
                    content:response.data.data
                })
            }else{
                //只将请求结果的data字段返回
                return response.data.data
            }
        },
        (err) => {
            //发生网络错误后会走到这里
            return Promise.resolve("网络请求：ERROR！")
        }
)
// 配置请求拦截器
fly.interceptors.request.use((request) => {
    request.headers["token"] = uni.getStorageSync('token');
    return request;
})
</code></pre>
<h2 id="同步封装微信登录">同步封装微信登录</h2>
<pre><code class="language-javascript">async function wxLogin() {
    return await new Promise((resolve, reject) => {
        wx.login({
            success(res) {
                if (res.code) {
                    resolve(res.code)
                }
            }
        })
    })
}
</code></pre>
<p>写一个接口如login</p>
<pre><code class="language-javascript">// 登录
export const login = async (params) => {
    console.log('开始登录...')
    let code = await wxLogin();
    let res = await fly.get('/user/login', {code: code})
    uni.setStorageSync('token', res.token)
    uni.setStorageSync('openid', res.openid)
}
</code></pre>
<h2 id="封装普通请求">封装普通请求</h2>
<pre><code class="language-javascript">export const updateUserInfo = (params) => {
    return fly.get('/user/update', params)
}
</code></pre>
<h2 id="引入方式-1">引入方式</h2>
<p>在<code>App.vue</code> 或者<code>main.js</code>添加以下代码</p>
<pre><code class="language-javascript">import * as API from './static/utils/api'
Vue.prototype.$api = API
</code></pre>
<h2 id="调用方式">调用方式</h2>
<blockquote>
<p>test.vue</p>
</blockquote>
<pre><code class="language-javascript">this.$api.login()
</code></pre>
</div></div></div></div></div></div><script defer src="/_nuxt/static/1619942794/post/306/state.js"></script><script src="/_nuxt/b0f8911.js" defer></script><script src="/_nuxt/fc6b942.js" defer></script><script src="/_nuxt/a1b9b3d.js" defer></script><script src="/_nuxt/02b3e78.js" defer></script>
</body>
<script defer>hljs.highlightAll()</script>
</html>

<!doctype html>
<html data-n-head-ssr lang="zh-CN" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22zh-CN%22%7D%7D">
<head>
  <title>Vue自定义指令</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta data-n-head="ssr" data-hid="keywords" name="keywords" content="thinkmoon,醉月思,指尖魔法屋"><meta data-n-head="ssr" data-hid="description" name="description" content="总结与记录是两个极其优秀的学习习惯！"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="/highlight/atom-one-dark.min.css"><link data-n-head="ssr" rel="stylesheet" href="/style.css"><script data-n-head="ssr" src="/highlight/highlight.min.js"></script><link rel="preload" href="/_nuxt/e4b7d96.js" as="script"><link rel="preload" href="/_nuxt/fc6b942.js" as="script"><link rel="preload" href="/_nuxt/css/edb8de7.css" as="style"><link rel="preload" href="/_nuxt/623b5d2.js" as="script"><link rel="preload" href="/_nuxt/746647a.js" as="script"><link rel="stylesheet" href="/_nuxt/css/edb8de7.css"><link rel="preload" href="/_nuxt/static/1620746793/post/910/state.js" as="script"><link rel="preload" href="/_nuxt/static/1620746793/post/910/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1620746793/manifest.js" as="script">
</head>
<body>
<div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="container"><div class="article-content"><h1 class="article-title">
      Vue自定义指令
    </h1> <div><h2 id="介绍">介绍</h2>
<p>Vue中的指令形如<code>v-*</code>，如v-if，v-show，v-model等。同时，除了Vue自带的一些默认指令外，Vue同时运行用户自定义指令，来扩展指令功能。</p>
<h2 id="使用场景">使用场景</h2>
<p>究竟什么情况下使用组件？而什么情况下使用指令呢？官方对此，给出了以下建议：</p>
<blockquote>
<p>注意，在 Vue2.0 中，代码复用和抽象的主要形式是组件。然而，有的情况下，你仍然需要对普通 DOM 元素进行底层操作，这时候就会用到自定义指令。</p>
</blockquote>
<p>也就是说，当你关注问题的抽象层级在DOM元素的时候，你就应该考虑使用自定义指令来完成需求了。</p>
<h2 id="作用范围">作用范围</h2>
<p>自定义指令有两种作用范围，一种是申明在全局，全局内有效。另一种，则是局部指令。</p>
<blockquote>
<p>钩子函数及相关参数见官网文档。</p>
</blockquote>
<h2 id="举个例子">举个例子</h2>
<h3 id="需求">需求</h3>
<p>我需要设计一个自定义指令<code>v-bug</code>，该指令可将作用元素的所有内容都替换为<code>烫烫烫烫</code>，指令可以指定有几个烫，以及是否追加<code>锟斤拷</code>。</p>
<h3 id="1-先将内容替换为一个烫">1. 先将内容替换为一个<code>烫</code></h3>
<blockquote>
<p>main.js</p>
</blockquote>
<pre><code class="language-javascript">import Vue from 'vue'
import App from './App.vue'

Vue.config.productionTip = false

Vue.directive('bug', {
  inserted: function (el) {
    el.innerHTML = "烫"
  }
})

new Vue({
  render: h => h(App),
}).$mount('#app')
</code></pre>
<blockquote>
<p>App.vue</p>
</blockquote>
<pre><code class="language-html">&lt;template>
  &lt;div id="app">
    &lt;HelloWorld v-bug />
  &lt;/div>
&lt;/template>

&lt;script>
import HelloWorld from './components/HelloWorld.vue'

export default {
  name: 'App',
  components: {
    HelloWorld
  }
}
&lt;/script>

&lt;style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
&lt;/style>
</code></pre>
<p>效果展示</p>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-09-20T05:28:47.png" alt="2020-09-20T05:28:47.png"></p>
<h3 id="2-生成指定个数的烫">2. 生成指定个数的<code>烫</code></h3>
<blockquote>
<p>main.js</p>
</blockquote>
<pre><code class="language-javascript">...
Vue.directive('bug', {
  inserted: function (el, binding) {
    el.innerHTML = Array(binding.value).fill("烫").join("")
  }
})
...
</code></pre>
<blockquote>
<p>App.vue</p>
</blockquote>
<pre><code class="language-html">&lt;template>
  &lt;div id="app">
    &lt;HelloWorld v-bug="12" />
  &lt;/div>
&lt;/template>
</code></pre>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-09-20T05:29:25.png" alt="2020-09-20T05:29:25.png"></p>
<h3 id="3-指定是否追加锟斤拷">3. 指定是否追加<code>锟斤拷</code></h3>
<blockquote>
<p>main.js</p>
</blockquote>
<pre><code class="language-javascript">...
Vue.directive('bug', {
  inserted: function (el, binding) {
    let html = Array(binding.value).fill("烫").join("")
    if(binding.modifiers.suffix){
      html += "锟斤拷"
    }
    el.innerHTML = html
  }
})
...
</code></pre>
<blockquote>
<p>App.vue</p>
</blockquote>
<pre><code class="language-html">&lt;template>
  &lt;div id="app">
    &lt;HelloWorld v-bug.suffix="12" />
  &lt;/div>
&lt;/template>
</code></pre>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-09-20T05:30:18.png" alt="2020-09-20T05:30:18.png"></p>
<p>但是此时的代码有个非常严重的问题，从上文代码中可看出，内容的改变只在inserted的时候执行。如果我们将指令后面设置为变量，变量值的改变却不会影响到<code>烫</code>个数（这一点都不Vue），所有我们应再监听一下指令的updated钩子函数。</p>
<h3 id="4-数据驱动（动态改变）">4. 数据驱动（动态改变）</h3>
<blockquote>
<p>App.vue</p>
</blockquote>
<pre><code class="language-html">&lt;script>
import HelloWorld from "./components/HelloWorld.vue";

let interval = null
export default {
    name: "App",
    components: {
        HelloWorld
    },
    data() {
        return {
            num: 12
        };
    },
    created() {
        interval = setInterval(() => {
            this.num++;
        }, 1000);
    },
    beforeDestroy(){
      clearInterval(interval)
    }
};
&lt;/script>
</code></pre>
<blockquote>
<p>main.js</p>
</blockquote>
<pre><code class="language-javascript">...
function generateHtml(binding){
  let html = Array(binding.value).fill("烫").join("")
  if (binding.modifiers.suffix) {
    html += "锟斤拷"
  }
  return html
}
Vue.directive('bug', {
  inserted: function (el, binding) {
    el.innerHTML = generateHtml(binding)
  },
  update: function (el, binding) {
    if (binding.oldValue !== binding.value) {
      el.innerHTML = generateHtml(binding)
    }
  },
})
...
</code></pre>
<p><img src="http://blog.cdn.thinkmoon.cn/blog/typecho/2020-09-11T14:22:08.png" alt="2020-09-11T14:22:08.png"><br>需求完成！</p>
</div></div></div></div></div></div><script defer src="/_nuxt/static/1620746793/post/910/state.js"></script><script src="/_nuxt/e4b7d96.js" defer></script><script src="/_nuxt/fc6b942.js" defer></script><script src="/_nuxt/623b5d2.js" defer></script><script src="/_nuxt/746647a.js" defer></script>
</body>
<script defer>hljs.highlightAll()</script>
</html>

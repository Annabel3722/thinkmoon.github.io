<!doctype html>
<html data-n-head-ssr lang="zh-CN" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22zh-CN%22%7D%7D">
<head>
  <title>让微信小程序页面默认支持分享及返回操作</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta data-n-head="ssr" data-hid="keywords" name="keywords" content="thinkmoon,醉月思,指尖魔法屋"><meta data-n-head="ssr" data-hid="description" name="description" content="总结与记录是两个极其优秀的学习习惯！"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="/highlight/atom-one-dark.min.css"><link data-n-head="ssr" rel="stylesheet" href="/style.css"><script data-n-head="ssr" src="/highlight/highlight.min.js"></script><link rel="preload" href="/_nuxt/e4b7d96.js" as="script"><link rel="preload" href="/_nuxt/fc6b942.js" as="script"><link rel="preload" href="/_nuxt/css/edb8de7.css" as="style"><link rel="preload" href="/_nuxt/623b5d2.js" as="script"><link rel="preload" href="/_nuxt/746647a.js" as="script"><link rel="stylesheet" href="/_nuxt/css/edb8de7.css"><link rel="preload" href="/_nuxt/static/1620746793/post/225/state.js" as="script"><link rel="preload" href="/_nuxt/static/1620746793/post/225/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1620746793/manifest.js" as="script">
</head>
<body>
<div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="container"><div class="article-content"><h1 class="article-title">
      让微信小程序页面默认支持分享及返回操作
    </h1> <div><h2 id="为啥需要这个？">为啥需要这个？</h2>
<blockquote>
<p>有时候我们写微信小程序，写好了。在手机上运行感觉效果还不错，正想分享给别人。突然发现没有分享选项，纳尼？原来是忘记写<code>onShareAppMessage()</code>了。有得加上，再编译。不得不说，麻烦的一匹。</p>
</blockquote>
<h2 id="应运而生">应运而生</h2>
<blockquote>
<p>然后我就想，要是可以让默认支持分享就好了。</p>
</blockquote>
<h2 id="wepy实现方法">wepy实现方法</h2>
<h2 id="大致思路">大致思路</h2>
<pre><code>import wepy from 'wepy';
export default class Page extends wepy.page {
}
</code></pre>
<blockquote>
<p>分析代码，发现所有的<code>page</code>都继承于<code>wepy.page</code>, 而<code>wepy.page</code>又继承于<code>wepy.component</code>. 这感情好。也就意味着我只需要构建一个超类继承<code>wepy.page</code>就可以了</p>
</blockquote>
<h2 id="实践">实践</h2>
<blockquote>
<p>新建page.js文件，内容如下</p>
</blockquote>
<pre><code class="language-javascript">import wepy from 'wepy';
export default class Page extends wepy.page {
    onShareAppMessage() {
        
    }
}
</code></pre>
<blockquote>
<p>然后再调整一下页面继承</p>
</blockquote>
<pre><code>import Page from '../page';
export default class Index extends Page {
}
</code></pre>
<blockquote>
<p>编译运行，果然如此！</p>
</blockquote>
<h2 id="如果要自定义分享内容怎么办？">如果要自定义分享内容怎么办？</h2>
<blockquote>
<p>在子page里面重构<code>onShareAppMessage</code>就可以啦。</p>
</blockquote>
<p>tips: 现使用uni-app后发现已经默认支持分享了</p>
<h2 id="后续：-uni-app说这是个bug，已经修复了。。">后续： uni-app说这是个BUG，已经修复了。。</h2>
<h2 id="后备方案使用mixin全局混入">后备方案——使用mixin全局混入</h2>
<ol>
<li>在main.js中添加以下内容。<pre><code>import qs from 'query-string'
Vue.mixin({
 onShareAppMessage() {
     console.log('分享路径', '/pages/index?route=' + this.$mp.page.route + '&' + qs.stringify(this.$mp.query))
     return {
         path: '/pages/index?route=' + this.$mp.page.route + '&' + qs.stringify(this.$mp.query)
     };
 }
})
</code></pre>
以上代码实现了所有页面都支持转发，并将转发路径设为主页。</li>
<li>在主页的onLoad函数中加入以下内容<pre><code>if (options.route) {
             uni.navigateTo({
                 url: '/' + options.route + '?' + qs.stringify(options)
             })
         }
</code></pre>
这样就实现了，进入后的页面跳转。</li>
<li>为什么要这样做？<br>因为大家都知道，当我们直接分享小程序页面给别人的时候。别人点击进入非tab页面，是没有返回操作的。增加了上面的功能后，所有页面的分享，都会先进入主页，再跳转至分享的页面。用户就可以无缝对接啦！</li>
</ol>
<blockquote>
<p>更新，现小程序已支持页面返回</p>
</blockquote>
</div></div></div></div></div></div><script defer src="/_nuxt/static/1620746793/post/225/state.js"></script><script src="/_nuxt/e4b7d96.js" defer></script><script src="/_nuxt/fc6b942.js" defer></script><script src="/_nuxt/623b5d2.js" defer></script><script src="/_nuxt/746647a.js" defer></script>
</body>
<script defer>hljs.highlightAll()</script>
</html>
